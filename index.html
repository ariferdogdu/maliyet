<!DOCTYPE html>
<html lang="tr">
<head>

<meta charset="UTF-8">
<title>ƒ∞n≈üaat Maliyet Takip</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
background:#111;
color:white;
font-family:Arial;
margin:20px;
}

h1{
text-align:center;
}

input{
padding:10px;
margin:5px;
background:#222;
color:white;
border:1px solid #444;
}

button{
padding:10px;
margin:5px;
border:none;
border-radius:6px;
background:#2e7d32;
color:white;
}

table{
width:100%;
border-collapse:collapse;
background:#1a1a1a;
}

th,td{
border:1px solid #333;
padding:10px;
text-align:center;
}

.kalemBaslik{
background:#333;
font-weight:bold;
}

.toplam{
text-align:right;
font-size:26px;
color:#4CAF50;
margin-top:15px;
}

.silBtn{
background:#c62828;
}

.duzenleBtn{
background:#ff9800;
}

</style>

</head>

<body>

<h1>üèóÔ∏è ƒ∞N≈ûAAT MALƒ∞YET TAKƒ∞P</h1>

<input type="date" id="tarih">
<input type="text" id="kalem">
<input type="number" id="tutar">

<button onclick="ekle()">Kaydet</button>
<button onclick="pdfAl()">PDF</button>

<table>

<tr>
<th>Tarih</th>
<th>Kalem</th>
<th>Tutar</th>
<th>ƒ∞≈ülem</th>
</tr>

<tbody id="liste">

</tbody>

</table>

<div class="toplam">

TOPLAM MALƒ∞YET:

<span id="toplam">0</span> TL

</div>

<script>

let token="BURAYA_YENI_TOKEN";
let user="ariferdogdu";
let repo="maliyet";
let file="veriler.json";

let veriler=[];

function formatTL(s){

return Number(s).toLocaleString('tr-TR');

}


async function yukle(){

let url=https://api.github.com/repos/${user}/${repo}/contents/${file};

let res=await fetch(url);

let data=await res.json();

let content=atob(data.content);

veriler=JSON.parse(content);

window.sha=data.sha;

goster();

}


async function kaydetGit(){

let url=https://api.github.com/repos/${user}/${repo}/contents/${file};

let body={

message:"veri guncellendi",

content:btoa(JSON.stringify(veriler,null,2)),

sha:window.sha

};


await fetch(url,{

method:"PUT",

headers:{

Authorization:"token "+token

},

body:JSON.stringify(body)

});


yukle();

}



function goster(){

let liste=document.getElementById("liste");

liste.innerHTML="";

let toplam=0;

let kalemler={};


veriler.forEach((v,i)=>{

if(!kalemler[v.kalem]) kalemler[v.kalem]=[];

kalemler[v.kalem].push({data:v,index:i});

toplam+=Number(v.tutar);

});


for(let k in kalemler){

liste.innerHTML+=`

<tr class="kalemBaslik">

<td colspan="4">${k}</td>

</tr>

`;

kalemler[k].forEach(v=>{

liste.innerHTML+=`

<tr>

<td>${v.data.tarih}</td>

<td>${v.data.kalem}</td>

<td>${formatTL(v.data.tutar)} TL</td>

<td>

<button class="duzenleBtn" onclick="duzenle(${v.index})">‚úèÔ∏è</button>

<button class="silBtn" onclick="sil(${v.index})">‚ùå</button>

</td>

</tr>

`;

});

}


document.getElementById("toplam").innerHTML=formatTL(toplam);

}



function ekle(){

veriler.push({

tarih:document.getElementById("tarih").value,

kalem:document.getElementById("kalem").value,

tutar:document.getElementById("tutar").value

});

kaydetGit();

}



function sil(i){

veriler.splice(i,1);

kaydetGit();

}



function duzenle(i){

let t=prompt("Tarih",veriler[i].tarih);

let k=prompt("Kalem",veriler[i].kalem);

let u=prompt("Tutar",veriler[i].tutar);

veriler[i]={

tarih:t,
kalem:k,
tutar:u

};

kaydetGit();

}



function pdfAl(){

html2pdf().from(document.body).save("insaat_maliyet.pdf");

}



yukle();

</script>

</body>

</html>